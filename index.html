<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VR Dream Villa - Vargas Edition</title>
    <!-- A-Frame script -->
    <script src="script/aframe.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600&display=swap');

        :root {
            --accent-color: #00d2ff;
            --bg-glass: rgba(15, 15, 15, 0.75);
            --text-color: #ffffff;
            --primary-gradient: linear-gradient(135deg, #00d2ff 0%, #3a7bd5 100%);
        }

        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Outfit', sans-serif;
            background: #000;
        }

        /* --- UI Manual Styles --- */
        #manual-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            background: var(--bg-glass);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 30px;
            padding: 40px;
            color: var(--text-color);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            box-shadow: 0 40px 100px rgba(0, 0, 0, 0.8);
            transition: all 0.6s cubic-bezier(0.16, 1, 0.3, 1);
            overflow: hidden;
        }

        #manual-container.hidden {
            opacity: 0;
            transform: translate(-50%, -45%) scale(0.95);
            pointer-events: none;
        }

        .manual-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .manual-header h1 {
            margin: 0;
            font-size: 2.2rem;
            font-weight: 600;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            text-transform: uppercase;
            letter-spacing: 3px;
        }

        .manual-content {
            flex-grow: 1;
            overflow-y: auto;
            padding-right: 15px;
            margin-bottom: 20px;
            scrollbar-width: thin;
            scrollbar-color: var(--accent-color) rgba(255, 255, 255, 0.05);
            scroll-behavior: smooth;
        }

        .manual-content::-webkit-scrollbar {
            width: 4px;
        }
        .manual-content::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }
        .manual-content::-webkit-scrollbar-thumb {
            background: var(--accent-color);
            border-radius: 10px;
        }

        /* Vertical Controls for Manual */
        .manual-vertical-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 10;
        }

        .scroll-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            font-size: 1.2rem;
        }

        .scroll-btn:hover {
            background: var(--accent-color);
            border-color: var(--accent-color);
            transform: scale(1.1);
        }

        .section-title {
            font-weight: 600;
            color: var(--accent-color);
            margin: 20px 0 12px 0;
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 1.5px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title::after {
            content: '';
            flex-grow: 1;
            height: 1px;
            background: rgba(255, 255, 255, 0.1);
        }

        .control-grid {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 12px;
            align-items: center;
            margin-bottom: 15px;
        }

        .key {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-bottom: 3px solid rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 5px 10px;
            font-family: 'Outfit', sans-serif;
            font-weight: 600;
            font-size: 0.9rem;
            min-width: 35px;
            text-align: center;
            color: var(--accent-color);
        }

        .instruction {
            font-size: 1rem;
            opacity: 0.85;
        }

        .btn-container {
            display: flex;
            justify-content: center;
            margin-top: 10px;
        }

        .start-btn {
            background: var(--primary-gradient);
            color: white;
            border: none;
            padding: 15px 45px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.23, 1, 0.32, 1);
            text-transform: uppercase;
            letter-spacing: 2px;
            box-shadow: 0 15px 30px rgba(0, 210, 255, 0.25);
        }

        .start-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 20px 40px rgba(0, 210, 255, 0.4);
        }

        #ui-toggle {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 55px;
            height: 55px;
            background: var(--bg-glass);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border-radius: 50%;
            cursor: pointer;
            z-index: 999;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--accent-color);
            font-size: 1.4rem;
            font-weight: bold;
            transition: all 0.4s ease;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }

        #ui-toggle:hover {
            background: #fff;
            color: #000;
            transform: rotate(180deg);
        }

        /* --- Loading Screen --- */
        #preloader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: opacity 1.2s ease;
        }

        .loader-ring {
            width: 60px;
            height: 60px;
            border: 2px solid rgba(0, 210, 255, 0.1);
            border-top: 2px solid var(--accent-color);
            border-radius: 50%;
            animation: spin 0.8s cubic-bezier(0.5, 0.1, 0.5, 0.9) infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            margin-top: 25px;
            color: white;
            letter-spacing: 4px;
            font-size: 0.75rem;
            text-transform: uppercase;
            opacity: 0.6;
        }
    </style>
</head>
<body>

    <!-- Preloader -->
    <div id="preloader">
        <div class="loader-ring"></div>
        <div class="loading-text">Initializing Villa</div>
    </div>

    <!-- Interface Toggle -->
    <div id="ui-toggle">?</div>

    <!-- Manual Overlay -->
    <div id="manual-container">
        <div class="manual-vertical-controls">
            <button class="scroll-btn" id="scroll-up" title="Scroll Up">↑</button>
            <button class="scroll-btn" id="scroll-down" title="Scroll Down">↓</button>
        </div>

        <div class="manual-content" id="manual-content">
            <div class="section-title">Movement</div>
            <div class="control-grid">
                <div class="key">W</div><div class="instruction">Walk Forward</div>
                <div class="key">A</div><div class="instruction">Walk Left</div>
                <div class="key">S</div><div class="instruction">Walk Backward</div>
                <div class="key">D</div><div class="instruction">Walk Right</div>
            </div>

            <div class="section-title">Flight & Elevation</div>
            <div class="control-grid">
                <div class="key">Q</div><div class="instruction">Ascend (Vertical Up)</div>
                <div class="key">E</div><div class="instruction">Descend (Vertical Down)</div>
            </div>

            <div class="section-title">Perspective</div>
            <div class="control-grid">
                <div class="key">Mouse</div><div class="instruction">Look Around</div>
            </div>
            
            <div class="section-title">Information</div>
            <p style="font-size: 0.9rem; opacity: 0.7; line-height: 1.7; margin-top: 0;">
                Welcome to your dream villa. After clicking "Begin Tour", please click on the screen again to enable movement. Use the vertical controls (Q/E) to explore different floors.
            </p>
        </div>

        <div class="btn-container">
            <button class="start-btn" id="start-btn">Begin Tour</button>
        </div>
    </div>

    <!-- A-Frame Scene -->
    <a-scene 
        renderer="antialias: true; colorManagement: true; logarithmicDepthBuffer: true; exposure: 1.2;"
        shadow="type: pcfsoft"
        loading-screen="enabled: false">
        
        <a-assets>
            <a-asset-item id="villa-model" src="villa.glb"></a-asset-item>
            <!-- Water textures -->
            <img id="water-tex" src="https://raw.githubusercontent.com/mrdoob/three.js/master/examples/textures/water/Water_2_M_Normal.jpg" crossorigin="anonymous">
            <img id="water-normal" src="https://raw.githubusercontent.com/mrdoob/three.js/master/examples/textures/water/Water_1_M_Normal.jpg" crossorigin="anonymous">
            <!-- Grass texture for the floor -->
            <img id="grass-texture" src="textures/grass.png">
        </a-assets>

        <!-- Lighting Environment -->
        <a-sky color="#87CEEB"></a-sky>
        
        <!-- Lights -->
        <a-entity light="type: ambient; color: #BBB; intensity: 0.6"></a-entity>
        <a-entity light="type: hemisphere; groundColor: #444; color: #FFF; intensity: 0.6"></a-entity>
        <a-entity light="type: directional; color: #fff; intensity: 1.2; castShadow: true; shadowCameraFar: 100; shadowMapHeight: 2048; shadowMapWidth: 2048;" position="-10 20 10"></a-entity>
        
        <!-- Floor / Ground -->
        <a-plane position="0 -0.05 0" rotation="-90 0 0" width="500" height="500" 
            src="#grass-texture" repeat="100 100" material="roughness: 1; metalness: 0" shadow="receive: true"></a-plane>

        <!-- Indoor Pool Structure (Placed relative to house) -->
        <a-entity id="pool-container" position="16.7 0.01 -56" rotation="0 90 0" scale="1 1 1">
            
            <!-- 1. POOL BOX (The structure) -->
            <a-box position="0 -0.5 0" width="25" height="1" depth="10" color="#4FC3F7" material="roughness: 0.1; metalness: 0.3" shadow="receive: true"></a-box>
            
            <!-- 2. WATER PLANE (The surface) -->
            <a-plane id="water" position="0 -0.1 0" rotation="-90 0 0" width="24.8" height="9.8" 
                segments-width="32" segments-height="32"
                material="color: #B2EBF2; transparent: true; opacity: 0.6; src: #water-tex; repeat: 10 5; normalMap: #water-normal; normalTextureRepeat: 10 5; side: double; metalness: 0.6; roughness: 0.1" 
                pool-water></a-plane>
        </a-entity>

        <!-- The Villa Model -->
        <a-entity 
            id="villa-entity"
            gltf-model="#villa-model" 
            position="0 0 -5" 
            scale="4 4 4"
            shadow="cast: true; receive: true">
        </a-entity>

        <!-- Player Rig: This is the main container for the user's view. -->
        <a-entity id="rig" position="0 20 20">
            <a-entity id="camera" camera 
                look-controls="pointerLockEnabled: false" 
                wasd-controls="acceleration: 65; fly: false;"
                vertical-controls="speed: 0.15">
            </a-entity>
        </a-entity>

    </a-scene>

    <script>
        /**
         * Custom A-Frame Component for Vertical Controls (Q/E)
         * Maps Q to move the camera up and E to move it down.
         */
        AFRAME.registerComponent('vertical-controls', {
            schema: {
                speed: { type: 'number', default: 0.1 }
            },
            init: function () {
                this.keys = {};
                this.onKeyDown = (e) => { this.keys[e.code] = true; };
                this.onKeyUp = (e) => { this.keys[e.code] = false; };
                window.addEventListener('keydown', this.onKeyDown);
                window.addEventListener('keyup', this.onKeyUp);
            },
            remove: function() {
                window.removeEventListener('keydown', this.onKeyDown);
                window.removeEventListener('keyup', this.onKeyUp);
            },
            tick: function (time, delta) {
                const rig = document.querySelector('#rig');
                const position = rig.getAttribute('position');
                
                const moveAmount = this.data.speed * (delta / 16.6);
                
                if (this.keys['KeyQ']) {
                    position.y += moveAmount;
                }
                if (this.keys['KeyE']) {
                    position.y -= moveAmount;
                }
                
                rig.setAttribute('position', position);
            }
        });

        /**
         * Water Animation Component
         */
        AFRAME.registerComponent('pool-water', {
            init: function () {
                this.tick = AFRAME.utils.throttleTick(this.tick, 25, this);
                this.waves = [
                    [1.0,  0.0,  0.8, 0.035, 3.0],
                    [0.0,  1.0,  1.0, 0.030, 2.5],
                    [0.7,  0.7,  0.6, 0.025, 4.0],
                    [-0.5, 0.8,  1.2, 0.045, 2.0],
                    [0.9, -0.4,  0.4, 0.018, 5.0],
                    [-0.3, 1.0,  0.5, 0.022, 4.5],
                    [1.0,  0.5,  1.5, 0.030, 1.6]
                ];
            },
            tick: function (time) {
                var mesh = this.el.getObject3D('mesh');
                if (!mesh || !mesh.geometry) return;
                var geo = mesh.geometry;
                var pos = geo.attributes.position;
                if (!this._origZ) {
                    this._origZ = new Float32Array(pos.count);
                    for (var i = 0; i < pos.count; i++) this._origZ[i] = pos.getZ(i);
                }
                var t = time * 0.001;
                for (var i = 0; i < pos.count; i++) {
                    var x = pos.getX(i);
                    var y = pos.getY(i);
                    var z = 0;
                    for (var w = 0; w < this.waves.length; w++) {
                        var wv = this.waves[w];
                        var phase = (x * wv[0] + y * wv[1]) / wv[2] + t * wv[4];
                        z += Math.sin(phase) * wv[3];
                    }
                    pos.setZ(i, this._origZ[i] + z);
                }
                pos.needsUpdate = true;
                geo.computeVertexNormals();
            }
        });

        // UI Logic
        const manual = document.getElementById('manual-container');
        const startBtn = document.getElementById('start-btn');
        const uiToggle = document.getElementById('ui-toggle');
        const preloader = document.getElementById('preloader');

        // Close manual and start
        startBtn.addEventListener('click', () => {
            manual.classList.add('hidden');
            // Force focus on the canvas to enable WASD movement immediately
            const scene = document.querySelector('a-scene');
            if (scene.canvas) {
                scene.canvas.focus();
            }
        });

        // Toggle manual
        uiToggle.addEventListener('click', () => {
            manual.classList.toggle('hidden');
        });

        // Preloader transition
        window.addEventListener('load', () => {
            setTimeout(() => {
                preloader.style.opacity = '0';
                setTimeout(() => {
                    preloader.style.display = 'none';
                }, 1200);
            }, 1000);
        });

        // Manual Scroll Logic
        const content = document.getElementById('manual-content');
        const scrollUp = document.getElementById('scroll-up');
        const scrollDown = document.getElementById('scroll-down');

        scrollUp.addEventListener('click', () => {
            content.scrollBy({ top: -100, behavior: 'smooth' });
        });

        scrollDown.addEventListener('click', () => {
            content.scrollBy({ top: 100, behavior: 'smooth' });
        });
    </script>
</body>
</html>
